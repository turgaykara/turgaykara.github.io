<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <title>Yeni ≈ûifre Belirle - PentestZone</title>
    <style>
        body { font-family: sans-serif; background: #121212; color: white; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .box { background: #1e1e1e; padding: 40px; border-radius: 8px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); width: 320px; text-align: center; }
        h2 { color: #bb86fc; margin-bottom: 20px; }
        input { display: block; width: 100%; margin: 15px 0; padding: 12px; background: #333; border: 1px solid #444; color: white; border-radius: 4px; box-sizing: border-box; }
        button { background: #03dac6; color: black; font-weight: bold; border: none; padding: 12px; cursor: pointer; width: 100%; border-radius: 4px; margin-top: 10px; }
        button:hover { background: #018786; }
    </style>
</head>
<body>

    <div class="box">
        <h2>üîí Yeni ≈ûifre</h2>
        <p>Hesabƒ±n i√ßin yeni bir ≈üifre belirle.</p>
        
        <form id="newPasswordForm">
            <input type="password" id="newPass" placeholder="Yeni ≈ûifre (En az 6 karakter)" required minlength="6">
            <input type="password" id="confirmPass" placeholder="≈ûifreyi Tekrarla" required minlength="6">
            <button type="submit">≈ûifreyi G√ºncelle</button>
        </form>
    </div>

    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      import { getAuth, confirmPasswordReset } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      // SENƒ∞N VERDƒ∞ƒûƒ∞N CONFIG Bƒ∞LGƒ∞LERƒ∞
      const firebaseConfig = {
        apiKey: "AIzaSyBYZH2eNta0Xm5DkaNMbCrx9og4F6P6jOU",
        authDomain: "pentest-b71d5.firebaseapp.com",
        projectId: "pentest-b71d5",
        storageBucket: "pentest-b71d5.firebasestorage.app",
        messagingSenderId: "733965925244",
        appId: "1:733965925244:web:5b0faa927b0089a18482f9",
        measurementId: "G-4N6KTXFKG7"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // URL'den 'oobCode' (Sƒ±fƒ±rlama Anahtarƒ±) parametresini √ßek
      function getParameterByName(name) {
          const url = window.location.href;
          name = name.replace(/[\[\]]/g, '\\$&');
          var regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)'),
              results = regex.exec(url);
          if (!results) return null;
          if (!results[2]) return '';
          return decodeURIComponent(results[2].replace(/\+/g, ' '));
      }

      const actionCode = getParameterByName('oobCode');

      // G√ºvenlik: Linkte kod yoksa i≈ülemi reddet
      if (!actionCode) {
          alert("Hatalƒ± veya eksik link! L√ºtfen maildeki linke tekrar tƒ±kla.");
          window.location.href = "login.html";
      }

      // Form g√∂nderilince
      document.getElementById('newPasswordForm').addEventListener('submit', (e) => {
          e.preventDefault();
          
          const newPass = document.getElementById('newPass').value;
          const confirmPass = document.getElementById('confirmPass').value;

          if (newPass !== confirmPass) {
              alert("≈ûifreler uyu≈ümuyor kanka, dikkatli yaz.");
              return;
          }

          // Firebase ≈üifre deƒüi≈ütirme i≈ülemi
          confirmPasswordReset(auth, actionCode, newPass)
              .then(() => {
                  alert("‚úÖ ≈ûifren ba≈üarƒ±yla deƒüi≈üti! Giri≈ü sayfasƒ±na y√∂nlendiriliyorsun...");
                  window.location.href = "login.html";
              })
              .catch((error) => {
                  console.error(error);
                  alert("‚ùå Hata: Bu linkin s√ºresi dolmu≈ü olabilir. Tekrar mail iste.");
                  window.location.href = "login.html";
              });
      });
    </script>

</body>
</html>